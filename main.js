(()=>{"use strict";function e(e){return{length:e,beenHit:0,hit:function(){this.beenHit++},isSunk:function(){return this.beenHit>=this.length}}}function t(e="computer"){return{player:e,playerBoard:{board:[...Array(10)].map((e=>Array(10).fill(null))),playedBoard:[...Array(10)].map((e=>Array(10).fill(null))),shipsAlive:0,placeShip:function(e,t,a,r){if("horizontal"===a)for(let a=0;a<r.length;a++)this.board[t][e+a]=r;else for(let a=0;a<r.length;a++)this.board[t+a][e]=r;this.shipsAlive++},receiveAttack:function(e,t){if(this.playedBoard[t][e])return;const a=this.board[t][e];a?(a.hit(),a.isSunk()&&this.shipsAlive--):this.board[t][e]=0,this.playedBoard[t][e]=1},allShipsSunk:function(){return!this.shipsAlive},playAvailable:function(){for(let e=0;e<10;e++)for(let t=0;t<10;t++)if(!this.playedBoard[e][t])return!0;return!1},canPlace:function(e,t,a,r){if("horizontal"===a){if(e+r.length-1>9)return!1;for(let a=0;a<r.length;a++)if(this.board[t][e+a])return!1}else{if(t+r.length-1>9)return!1;for(let a=0;a<r.length;a++)if(this.board[t+a][e])return!1}return!0},randomPlace:function(e){let t,a;const r=Math.floor(2*Math.random())?"horizontal":"vertical";do{t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random())}while(!this.canPlace(t,a,r,e));this.placeShip(t,a,r,e)},reset:function(){this.board=[...Array(10)].map((e=>Array(10).fill(null))),this.playedBoard=[...Array(10)].map((e=>Array(10).fill(null))),this.shipsAlive=0}},attack:function(e,t,a){e.receiveAttack(t,a)},randomCoord:function(e){if(!e.playAvailable())return;let t,a;do{t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random())}while(e.playedBoard[a][t]);return{x:t,y:a}}}}async function a(e,t){let a=!0;for(;!e.playerBoard.allShipsSunk()&&!t.playerBoard.allShipsSunk();){if(a){const o=await r(".computer");t.playerBoard.playedBoard[o.y][o.x]||(e.attack(t.playerBoard,o.x,o.y),a=!a)}else{const r=t.randomCoord(e.playerBoard);t.attack(e.playerBoard,r.x,r.y),a=!a}o(e,t)}}function r(e){return new Promise((t=>{const a=document.querySelectorAll(`.container${e} .cell`);function r(e){const o=e.target,l=Number(o.dataset.x),n=Number(o.dataset.y);a.forEach((e=>{e.removeEventListener("click",r)})),t({x:l,y:n})}a.forEach((e=>{e.addEventListener("click",r)}))}))}function o(e,t){function a(e,t,a,r,o){e[r][o]&&document.querySelector(`${t} [data-x="${o}"][data-y="${r}"]`).classList.add(a)}for(let r=0;r<10;r++)for(let o=0;o<10;o++)a(t.playerBoard.playedBoard,".computer","played",r,o),a(e.playerBoard.playedBoard,".player","played",r,o),a(e.playerBoard.board,".player","ship",r,o),a(t.playerBoard.board,".computer","ship",r,o)}function l(e){const t=document.querySelector(e);for(let e=0;e<10;e++)for(let a=0;a<10;a++){const r=document.createElement("div");r.classList.add("cell"),r.dataset.x=a,r.dataset.y=e,t.appendChild(r)}}!function(){const n=t("1"),i=t("computer");l(".container.player"),l(".container.computer"),async function(t,l){const n=document.getElementById("alignment-button");let i=!1,c="horizontal";n.addEventListener("click",(()=>{c=i?"horizontal":"vertical",i=!i,n.textContent=c}));const d=[2,3,3,4,5],s=document.querySelector(".container.player");s.addEventListener("mouseover",(function(a){const r=a.target;if(r.classList.contains("cell")){const a=d[t.playerBoard.shipsAlive];for(let o=0;o<a;o++)if(t.playerBoard.canPlace(Number(r.dataset.x),Number(r.dataset.y),c,e(a))){const e="horizontal"===c?[o,0]:[0,o];document.querySelector(`.container.player [data-x="${Number(r.dataset.x)+e[0]}"][data-y="${Number(r.dataset.y)+e[1]}"]`).classList.add("place")}}})),s.addEventListener("mouseout",(function(a){const r=a.target;if(r.classList.contains("cell")){const a=d[t.playerBoard.shipsAlive];for(let o=0;o<a;o++)if(t.playerBoard.canPlace(Number(r.dataset.x),Number(r.dataset.y),c,e(a))){const e="horizontal"===c?[o,0]:[0,o];document.querySelector(`.container.player [data-x="${Number(r.dataset.x)+e[0]}"][data-y="${Number(r.dataset.y)+e[1]}"]`).classList.remove("place")}}}));let u=!0;for(;u;){for(;t.playerBoard.shipsAlive<d.length;){const a=d[t.playerBoard.shipsAlive];let n;do{n=await r(".player")}while(!t.playerBoard.canPlace(n.x,n.y,c,e(a)));t.playerBoard.placeShip(n.x,n.y,c,e(a)),o(t,l)}l.playerBoard.randomPlace(e(5)),l.playerBoard.randomPlace(e(4)),l.playerBoard.randomPlace(e(3)),l.playerBoard.randomPlace(e(3)),l.playerBoard.randomPlace(e(2)),await a(t,l);const n=document.getElementById("modal"),i=document.getElementById("modal-text"),s=t.playerBoard.allShipsSunk()?"Computer Wins!":"Player Wins!";i.textContent=s,n.showModal(),await new Promise((e=>{document.getElementById("new-game").addEventListener("click",(()=>{t.playerBoard.reset(),l.playerBoard.reset(),n.close(),document.querySelectorAll(".cell").forEach((e=>{e.classList.remove("ship","played","place")})),e()})),document.getElementById("modal-close").addEventListener("click",(()=>{n.close(),u=!1,e()}))}))}}(n,i)}()})();